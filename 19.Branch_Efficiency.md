# 分支效率（Branch Efficiency）

分支效率（Branch Efficiency） 衡量的是：当遇到条件语句时，warp 内的所有线程 多大程度上执行相同的路径。

分支效率的计算方式是：统一控制流决策的次数 ÷ 执行的分支指令总数。

控制流的统一性是在 warp 级别 上衡量的，因此分支效率可以反映 warp 发散（warp divergence）的缺失程度。

并非所有条件语句都会降低分支效率。大多数 kernel 中常见的 边界检查（bounds-check）片段 通常具有很高的分支效率，因为大部分 warp 中的线程在条件判断中会有相同的值，只有少数 warp 内的线程索引跨越边界 n 才会出现不同。

CPU 也关注分支行为的统一性，但它们主要关注的是 随时间的一致性，通过硬件控制的 分支预测和推测执行 来优化性能。

也就是说，当 CPU 内的电路在程序执行过程中多次遇到同一个分支时，会积累数据，从而提高性能。

GPU 则关注 空间上的统一性。也就是说，统一性是在 warp 内衡量的——warp 内线程同时执行，但映射到不同数据上。如果这些线程在分支上保持一致，则 GPU 性能会提高。

```cpp
int idx = blockIdx.x * blockDim.x + threadIdx.x;
    if (idx < n)
```